<div class="referral-content tree active">
    <div class="referral-tree">
        <!-- tree start -->
        <ul class="tree-ul active">
            <li class="tree-li">
                <span class="tree-item has">
                    <div class="tree-item-icon">
                        <i
                            class="fa-solid fa-square-plus"></i>
                        <i
                            class="fa-regular fa-square-minus"></i>

                    </div>
                    <div class="tree-item-username">
                        unidi</div>-
                    <div class="tree-item-fullname">
                        Nguyễn Văn A</div>-
                    <div class="tree-item-date">
                        22-8-2022</div>
                </span>
                <ul class="tree-ul">
                    <li class="tree-li">
                        <span class="tree-item">
                            <div class="tree-item-icon">
                                <i
                                    class="fa-solid fa-square-plus"></i>
                                <i
                                    class="fa-regular fa-square-minus"></i>
                            </div>
                            <div
                                class="tree-item-username">
                                unidi12</div>-
                            <div
                                class="tree-item-fullname">
                                Nguyễn Văn A</div>-
                            <div class="tree-item-date">
                                22-8-2022</div>
                        </span>
                    </li>
                    <li class="tree-li">
                        <span class="tree-item has">
                            <div
                                class="tree-item-icon ">
                                <i
                                    class="fa-solid fa-square-plus"></i>
                                <i
                                    class="fa-regular fa-square-minus"></i>
                            </div>
                            <div
                                class="tree-item-username">
                                unidi</div>-
                            <div
                                class="tree-item-fullname">
                                Nguyễn Văn A</div>-
                            <div class="tree-item-date">
                                22-8-2022</div>
                        </span>
                        <ul class="tree-ul">
                            <li class="tree-li">
                                <span
                                    class="tree-item has">
                                    <div
                                        class="tree-item-icon">
                                        <i
                                            class="fa-solid fa-square-plus"></i>
                                        <i
                                            class="fa-regular fa-square-minus"></i>
                                    </div>
                                    <div
                                        class="tree-item-username">
                                        unidi</div>-
                                    <div
                                        class="tree-item-fullname">
                                        Nguyễn Văn A
                                    </div>-
                                    <div
                                        class="tree-item-date">
                                        22-8-2022</div>
                                </span>
                                <ul class="tree-ul">
                                    <li class="tree-li">
                                        <span
                                            class="tree-item">
                                            <div
                                                class="tree-item-icon">
                                                <i
                                                    class="fa-solid fa-square-plus"></i>
                                                <i
                                                    class="fa-regular fa-square-minus"></i>
                                            </div>
                                            <div
                                                class="tree-item-username">
                                                unidi
                                            </div>-
                                            <div
                                                class="tree-item-fullname">
                                                Nguyễn
                                                Văn A
                                            </div>-
                                            <div
                                                class="tree-item-date">
                                                22-8-2022
                                            </div>
                                        </span>
                                    </li>
                                    <li class="tree-li">
                                        <span
                                            class="tree-item">
                                            <div
                                                class="tree-item-icon">
                                                <i
                                                    class="fa-solid fa-square-plus"></i>
                                                <i
                                                    class="fa-regular fa-square-minus"></i>
                                            </div>
                                            <div
                                                class="tree-item-username">
                                                unidi
                                            </div>-
                                            <div
                                                class="tree-item-fullname">
                                                Nguyễn
                                                Văn A
                                            </div>-
                                            <div
                                                class="tree-item-date">
                                                22-8-2022
                                            </div>
                                        </span>
                                    </li>
                                    <li class="tree-li">
                                        <span
                                            class="tree-item">
                                            <div
                                                class="tree-item-icon">
                                                <i
                                                    class="fa-solid fa-square-plus"></i>
                                                <i
                                                    class="fa-regular fa-square-minus"></i>
                                            </div>
                                            <div
                                                class="tree-item-username">
                                                unidi
                                            </div>-
                                            <div
                                                class="tree-item-fullname">
                                                Nguyễn
                                                Văn A
                                            </div>-
                                            <div
                                                class="tree-item-date">
                                                22-8-2022
                                            </div>
                                        </span>
                                    </li>
                                </ul>
                            </li>
                            <li class="tree-li">
                                <span class="tree-item">
                                    <div
                                        class="tree-item-icon">
                                        <i
                                            class="fa-solid fa-square-plus"></i>
                                        <i
                                            class="fa-regular fa-square-minus"></i>
                                    </div>
                                    <div
                                        class="tree-item-username">
                                        unidi</div>-
                                    <div
                                        class="tree-item-fullname">
                                        Nguyễn Văn A
                                    </div>-
                                    <div
                                        class="tree-item-date">
                                        22-8-2022</div>
                                </span>
                            </li>
                            <li class="tree-li">
                                <span class="tree-item">
                                    <div
                                        class="tree-item-icon">
                                        <i
                                            class="fa-solid fa-square-plus"></i>
                                        <i
                                            class="fa-regular fa-square-minus"></i>
                                    </div>
                                    <div
                                        class="tree-item-username">
                                        unidi</div>-
                                    <div
                                        class="tree-item-fullname">
                                        Nguyễn Văn A
                                    </div>-
                                    <div
                                        class="tree-item-date">
                                        22-8-2022</div>
                                </span>
                            </li>
                        </ul>

                    </li>
                </ul>
            </li>
            <li class="tree-li">
                <span class="tree-item has">
                    <div class="tree-item-icon">
                        <i
                            class="fa-solid fa-square-plus"></i>
                        <i
                            class="fa-regular fa-square-minus"></i>

                    </div>
                    <div class="tree-item-username">
                        unidi</div>-
                    <div class="tree-item-fullname">
                        Nguyễn Văn A</div>-
                    <div class="tree-item-date">
                        22-8-2022</div>
                </span>
                <ul class="tree-ul">
                    <li class="tree-li">
                        <span class="tree-item">
                            <div class="tree-item-icon">
                                <i
                                    class="fa-solid fa-square-plus"></i>
                                <i
                                    class="fa-regular fa-square-minus"></i>
                            </div>
                            <div
                                class="tree-item-username">
                                unidi12</div>-
                            <div
                                class="tree-item-fullname">
                                Nguyễn Văn A</div>-
                            <div class="tree-item-date">
                                22-8-2022</div>
                        </span>
                    </li>
                    <li class="tree-li">
                        <span class="tree-item has">
                            <div
                                class="tree-item-icon ">
                                <i
                                    class="fa-solid fa-square-plus"></i>
                                <i
                                    class="fa-regular fa-square-minus"></i>
                            </div>
                            <div
                                class="tree-item-username">
                                unidi</div>-
                            <div
                                class="tree-item-fullname">
                                Nguyễn Văn A</div>-
                            <div class="tree-item-date">
                                22-8-2022</div>
                        </span>
                        <ul class="tree-ul">
                            <li class="tree-li">
                                <span
                                    class="tree-item has">
                                    <div
                                        class="tree-item-icon">
                                        <i
                                            class="fa-solid fa-square-plus"></i>
                                        <i
                                            class="fa-regular fa-square-minus"></i>
                                    </div>
                                    <div
                                        class="tree-item-username">
                                        unidi</div>-
                                    <div
                                        class="tree-item-fullname">
                                        Nguyễn Văn A
                                    </div>-
                                    <div
                                        class="tree-item-date">
                                        22-8-2022</div>
                                </span>
                                <ul class="tree-ul">
                                    <li class="tree-li">
                                        <span
                                            class="tree-item">
                                            <div
                                                class="tree-item-icon">
                                                <i
                                                    class="fa-solid fa-square-plus"></i>
                                                <i
                                                    class="fa-regular fa-square-minus"></i>
                                            </div>
                                            <div
                                                class="tree-item-username">
                                                unidi
                                            </div>-
                                            <div
                                                class="tree-item-fullname">
                                                Nguyễn
                                                Văn A
                                            </div>-
                                            <div
                                                class="tree-item-date">
                                                22-8-2022
                                            </div>
                                        </span>
                                    </li>
                                    <li class="tree-li">
                                        <span
                                            class="tree-item">
                                            <div
                                                class="tree-item-icon">
                                                <i
                                                    class="fa-solid fa-square-plus"></i>
                                                <i
                                                    class="fa-regular fa-square-minus"></i>
                                            </div>
                                            <div
                                                class="tree-item-username">
                                                unidi
                                            </div>-
                                            <div
                                                class="tree-item-fullname">
                                                Nguyễn
                                                Văn A
                                            </div>-
                                            <div
                                                class="tree-item-date">
                                                22-8-2022
                                            </div>
                                        </span>
                                    </li>
                                    <li class="tree-li">
                                        <span
                                            class="tree-item">
                                            <div
                                                class="tree-item-icon">
                                                <i
                                                    class="fa-solid fa-square-plus"></i>
                                                <i
                                                    class="fa-regular fa-square-minus"></i>
                                            </div>
                                            <div
                                                class="tree-item-username">
                                                unidi
                                            </div>-
                                            <div
                                                class="tree-item-fullname">
                                                Nguyễn
                                                Văn A
                                            </div>-
                                            <div
                                                class="tree-item-date">
                                                22-8-2022
                                            </div>
                                        </span>
                                    </li>
                                </ul>
                            </li>
                            <li class="tree-li">
                                <span class="tree-item">
                                    <div
                                        class="tree-item-icon">
                                        <i
                                            class="fa-solid fa-square-plus"></i>
                                        <i
                                            class="fa-regular fa-square-minus"></i>
                                    </div>
                                    <div
                                        class="tree-item-username">
                                        unidi</div>-
                                    <div
                                        class="tree-item-fullname">
                                        Nguyễn Văn A
                                    </div>-
                                    <div
                                        class="tree-item-date">
                                        22-8-2022</div>
                                </span>
                            </li>
                            <li class="tree-li">
                                <span class="tree-item">
                                    <div
                                        class="tree-item-icon">
                                        <i
                                            class="fa-solid fa-square-plus"></i>
                                        <i
                                            class="fa-regular fa-square-minus"></i>
                                    </div>
                                    <div
                                        class="tree-item-username">
                                        unidi</div>-
                                    <div
                                        class="tree-item-fullname">
                                        Nguyễn Văn A
                                    </div>-
                                    <div
                                        class="tree-item-date">
                                        22-8-2022</div>
                                </span>
                            </li>
                        </ul>

                    </li>
                </ul>
            </li>

        </ul>
        <!-- tree end -->
    </div>
</div>
<script>
    function buildCategoryTree(categories, parentId = 0) {
  let branch = [];
  categories.forEach((category) => {
    if (category.parent_id == parentId) {
      let children = buildCategoryTree(categories, category.id);
      if (children.length > 0) {
        category.children = children;
      }
      branch.push(category);
    }
  });

  return branch;
}
function fetchCategory(id, callBack) {
  $.ajax({
    url: "?mod=request&act=get-all-category&idCate=" + id,
  }).done((data) => {
    data = JSON.parse(data);
    renderCategory(data,callBack)
  });
}
function renderCategory(data, callBack) {
  if (data.length > 0) {
    const html = data
      .map((item) => {
        return `
            <div class="modal-cate-item"
                idCate="${item.id}" checkLast="${
          item?.children?.length > 0 ? "has" : "no"
        }">
                <p>
                    ${item.name}
                </p>
                ${
                  item?.children?.length > 0
                    ? `<i class="fa-solid fa-chevron-right"></i>`
                    : ""
                }
            </div>
          `;
      })
      .join("");
    $(this).closest(".modal-cate-group").after(`
      <div class="modal-cate-group">
          <div class="modal-cate-group-wrapper">
            ${html}
          </div>
      </div>
    `);
  }
  if (callBack) {
    callBack();
  }
}
function selectCategory(callBack) {
  $(".modal-cate-item").each((index, element) => {
    $(element).on("click", function () {
      // ===
      $(this).closest(".modal-cate-group").nextAll()?.remove();
      console.log($(this).closest(".modal-cate-group"));
      $(this)
        .closest(".modal-cate-group")
        .find(".modal-cate-item")
        ?.removeClass("active");
      $(this).addClass("active");
      const type = $(this).attr("checkLast")?.trim();
      const id = $(this).attr("idCate");
      if (type == "has") {
        console.log(id);
        // $(this).closest('.modal-cate-group').nextAll().remove()
        $.ajax({
          url: "?mod=request&act=get-all-category&idCate=" + id,
        }).done((data) => {
          data = JSON.parse(data);
          renderCategory(data,callBack)
          // if (tree.length > 0) {
          //   const html = tree
          //     .map((item) => {
          //       return `
          //           <div class="modal-cate-item"
          //               idCate="${item.id}" checkLast="${
          //         item?.children?.length > 0 ? "has" : "no"
          //       }">
          //               <p>
          //                   ${item.name}
          //               </p>
          //               ${
          //                 item?.children?.length > 0
          //                   ? `<i class="fa-solid fa-chevron-right"></i>`
          //                   : ""
          //               }
          //           </div>
          //         `;
          //     })
          //     .join("");
          //   $(this).closest(".modal-cate-group").after(`
          //     <div class="modal-cate-group">
          //         <div class="modal-cate-group-wrapper">
          //           ${html}
          //         </div>
          //     </div>
          //   `);
          // }
          // selectCategory();
        });
      } else {
        console.log("no ", id);
      }
      // ===
    });
  });
  // $(".modal-cate-item").click(function () {

  // });
}
</script>